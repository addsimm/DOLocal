
{% extends "josstaff/staff_base.html" %}
{% load i18n tz pages_tags mezzanine_tags staticfiles %}


{% block all_content %}

    {{ block.super }}

    To do: manage sessions, format windows, place moderator at top

    <div class="row" style="margin-top: 50px; background-color: lightblue;">

        <div class="col-xs-4 col-xs-offset-2" style="background-color: lightgreen;">

            Live video test:

            <div id="publisher" class="row"
                 style="background-color: pink;>
                 margin-top: 100px;">
                Publisher:
            </div>

            <div id="subscribers" class="row"
                 style="background-color: yellow;
                 margin-top: 100px;">
                Subscribers:
            </div>

        </div>

    </div>


    <script src="https://static.opentok.com/v2/js/opentok.min.js" charset="utf-8"></script>

    <script charset="utf-8">
        var apiKey = '45616422';
        var sessionId = '{{ session_id}}';
        var token = '{{ token }}';
        var session = OT.initSession(apiKey, sessionId)

        session.on('streamCreated', function (event) {
                    var subContainer = document.createElement('div');
                    subContainer.id = 'stream-' + event.stream.streamId;
                    document.getElementById('subscribers').appendChild(subContainer);

                    // Subscribe to stream that caused event, put inside container
                    session.subscribe(event.stream, subContainer);
                })

                .connect(token, function (error) {
                    if (!error) {
                        var publisher = OT.initPublisher('publisher', {
                            insertMode: 'append',
                            width: '30%'
                        });
                        session.publish(publisher);
                    }
                });

    </script>

{% endblock all_content %}