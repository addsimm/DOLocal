{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags  static %}

{% block meta_title %}
    {{ story.title | striptags | truncatechars:25 }}
{% endblock %}
{% block title %}
    {{ story.title | striptags | truncatechars:25 }}
{% endblock %}

{% block breadcrumb_menu %}

    {{ block.super }}
    <span style="font-size: 16pt; font-weight: normal">Story:</span>
    {{ story.title  | striptags | truncatechars:25 }}
    </div></div>

{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static "css/jquery-confirm.css" %}">
{% endblock %}

{% block extra_js %}
    <script src="{% static "js/jquery-confirm.js" %}"></script>
{% endblock %}


{% block all_content %}

<style>

    p {
        margin: 0;
    }

    .fixed {
        height: 600px;
        overflow: hidden;
    }

    .scrollit {
        height: 900px;
        overflow-y: scroll;
    }

    .edit_border {
        border: 3px dashed #28a4c9;
    }

    .edit_border_active {
        border: 10px solid #28a4c9;
    }

   .cke {
        margin-left: 25px;
    }

    .tooltip-inner {
        background: lightyellow;
        border: solid 2px rgb(65, 45, 120);
        color: rgb(65, 45, 120);
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 12pt;
        padding: 5px;
    }


</style>



<script>

    $.alert({
        title: 'Alert!',
        content: 'Simple alert!',
        confirm: function(){
            $.alert('Confirmed!'); // shorthand.
        }
    });

</script>

<div class="row" style="margin-top: 50px;">

    <!-- Center Panel -->
    <div class="col-xs-10 scrollit" style=" ">

        <!-- Title -->
        <div class="row" style=" ">
            <div class="col-xs-12">

                <div id='title_border' class="{% if edit %}edit_border{% endif %}" style="padding: 3px;">

                    <!-- Edit Buttons -->
                    <div class="col-xs-12">

                        {% if edit %}
                            <span id="hint" style="display: none; font-size: 10pt; ">
                                Hint: Bottom right triangle resizes editor <i class="fa fa-hand-o-down"></i></span>
                            <button
                                id="edit_title"
                                class="btn btn-info btn-xs pull-right"
                                style="margin-left: 5px; width: 80px;"
                                onclick="manageCKEdit(this)"
                                data-toggle="tooltip"
                                title="Activates the word processor."
                                data-placement="bottom"
                            >
                                <span style="font-size: 14pt;">Edit</span>
                            </button>


                            <button
                                id="save_title"
                                class="btn btn-success btn-xs pull-right"
                                style="display: none; margin-left: 5px; width: 80px;"
                                onclick="manageCKEdit(this)"
                                data-toggle="tooltip"
                                title="Will replace previous text."
                                data-placement="bottom"
                            >
                                <span style="font-size: 14pt;">Save</span>
                            </button>

                            <button
                                id="discard_title"
                                class="btn btn-danger btn-xs pull-right"
                                style="display: none; width: 80px;"
                                onclick="manageCKEdit(this)"
                                data-toggle="tooltip"
                                title="Will NOT save changes!"
                                data-placement="bottom"
                            >
                                <span style="font-size: 14pt;">Discard</span>
                            </button>

                        {% endif %}

                    </div>


                    <div class="row">
                        <form id='story_title_form'
                              method="post"
                              {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                            {% csrf_token %}
                            <div id='title' class="col-xs-12 homehead text-center">
                                {{ story.title | striptags }}<br>
                            </div>
                        </form>
                    </div>
                </div>

{#<br>Temporary:<input id="your_name" type="text" name="nucontent" value="{{ story.title }}"><br>#}

                <div class="joscursive text-center">
                    {{ story.author.JOSProfile.jos_name }}<br>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="row" style=" ">

            <div class="col-xs-12">

                <div style="{% if edit %}border: 3px dashed #28a4c9;{% endif %}">
                    <div class="row" style="height:40px;">
                        <div class="col-xs-12">
                            <!-- Edit Button -->
                            {% if edit %}
                                <a class="start_editor_button btn btn-info btn-xs pull-right"
                                   style="width: 80px"
                                   href="{% url "josstory_edit" story.id %}/?field_to_edit=content">
                                    <span style="font-size: 14pt;">Edit</span>
                                </a>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12" style="padding: 0 25px;">
                            <div id='editor1' contenteditable="false">

                                {{ story.content | richtext_filters | safe }}

                            </div>
                        </div>
                    </div>

                    <div class="row" style="height:30px;">
                        <div class="col-xs-12">
                            <!-- Edit Button -->
                            {% if edit %}
                                <a class="btn btn-info btn-xs pull-right"
                                   style="width: 80px"
                                   href="{% url "josstory_edit" story.id %}/?field_to_edit=content">
                                    <span style="font-size: 14pt;">Edit</span>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Panel -->
    <div class="col-xs-2 fixed" style=" ">

        <div style="font-size: 10pt; margin-bottom: 50px;">
            {% if not edit %}
                Hint:<br><i class="fa fa-hand-o-left"></i> The story scrolls
            {% endif %}
        </div>
        {% include "updated.html" with myobj=story %}<br>

        {% if story.author == request.user %}

            <a class="btn pull-right btn-info"
               data-toggle="tooltip"
               title="Turns editing on / off."
               data-placement="top"
               style="margin-top: 30px;"
                    {% if edit %}
                        href="{% url "josstory" story.id %}">
                        {% trans "Hide edit" %}
                    {% else %}
                        href="{% url "josstory_edit" story.id %}">
                        {% trans "Edit" %}
                    {% endif %}
            </a><br>

            <a class="btn pull-right {% if story.publish %}btn-danger{% else %}btn-success{% endif %}"
               style="margin-top: 30px;"
                    {% if story.publish %}
               href="{% url "josstory" story.id %}/?pub=remove">
                        {% trans "Hide" %}
                    {% else %}
                        href="{% url "josstory" story.id %}/?pub=publish">
                        {% trans "Publish" %}
                    {% endif %}
            </a><br>

            <a class="btn pull-right btn-warning"
               style="margin-top: 30px;"
               href="{% url "mystory_list" %}">
                {% trans "My stories" %}
            </a>
        {% endif %}<br>

        <a class="btn pull-right btn-warning"
           style="margin-top: 30px;"
           href="{% url "story_gallery" %}">
            {% trans "Gallery" %}
        </a><br>

        {# comment #}
        <a class="btn pull-right btn-default"
           style="margin-top: 90px;"
           href="{% url "spirit:topic:publish" 3 %}">
            {% trans "Comment" %}
        </a><br>

    </div>
</div>





<script>

    $(document).ready(function () {
        CKEDITOR.disableAutoInline = true;

        $('[data-toggle="tooltip"]').tooltip();


    });

    function manageCKEdit(el) {
        var elstrid = '#' + el.id;
        var strpos = elstrid.search("_");
        var actsection = elstrid.slice(strpos + 1);
        var acttxt = $(elstrid).text().trim();
        var bordertxt = '#' + actsection + '_border';

        switch (acttxt) {
            case "Edit":
                $('#edit_' + actsection).hide();
                $('#hint').show();
                $('#save_' + actsection).show();
                $('#discard_' + actsection).show();
                $(bordertxt).removeClass('edit_border').addClass('edit_border_active');
                activateCKEdit(actsection);
                break;

            case "Save":

                alert("Save");
                break;

            case "Discard":

                //confirm dialog

                CKEDITOR.instances.title.destroy();
                $('#edit_' + actsection).show();
                $('#hint').hide();
                $('#save_' + actsection).hide();
                $('#discard_' + actsection).hide();
                $(bordertxt).addClass('edit_border').removeClass('edit_border_active');
                break;
        }
    }

    function activateCKEdit(section) {

        CKEDITOR.replace(section, {
            toolbar: [
                {'name': 'clipboard', 'items': ['Undo', 'Redo', 'Cut', 'Copy', 'Paste']},
                {'name': 'styles', 'items': ['Font', 'FontSize']},
                {
                    'name': 'basicstyles',
                    'items': ['Bold', 'Italic', 'Underline', 'Strike', '-', 'TextColor', 'BGColor']
                },
                {
                    'name': 'paragraph',
                    'items': ['JustifyLeft', 'JustifyCenter', 'JustifyRight', '-', 'NumberedList', 'BulletedList',]
                },
                {
                    'name': 'insert', 'items': ['Image', 'Smiley']
                },
                {'name': 'editing', 'items': ['SelectAll', 'Find']}
            ],
            contentsCss: '/static/ckeditor/ckeditor/contents.css',
            disableNativeSpellChecker: false,
            width: '95%',
            tabSpaces: 4,
            extraPlugins: 'colorbutton'
        });
    }

</script>

{% endblock %}



