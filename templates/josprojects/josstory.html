{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags  static %}

{% block meta_title %}{{ story.title | striptags | truncatechars:25 }}{% endblock %}
{% block title %}{{ story.title | striptags | truncatechars:25 }}{% endblock %}
{% block breadcrumb_menu %}{{ block.super }}
    {{ story.title  | striptags | truncatechars:20 }} <span style="font-size: 18pt; font-style: italic; margin-left: 5px;"> by {{ story.author.JOSProfile.jos_name }}</span></div></div>
{% endblock %}

{% block all_content %}
<style> .cke { margin-left: 25px;}</style>

<div class="row" style="margin-top: 20px;">

<!-- Main Panel -->
<div class="col-xs-10 scrollit" style="border-right: 1px solid rgb(65, 45, 120);">

    <!-- Title -->
    <div class="row" style=" ">
        <div class="col-xs-12">

            <div style="height: 30px; margin-bottom: 10px; margin-left: 15px;">
                <span class="joshint"
                      style="display: none; font-size: 16pt;"
                      data-toggle="tooltip"
                      title="Dragging bottom right triangle changes the editor's height"
                      data-placement="bottom">
                Hint: Drag to change editor height
                </span>
            </div>

            <div id='border_title'
                 class="{% if edit %}edit_border{% endif %} edit_border_class"
                 style="padding: 3px;">

                <!-- Title Edit Buttons -->
                {% include "jos_editor.html" with section='title' %}

                <div class="row">
                    <form id='title_form'
                          method="post"
                          {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                        <div id='title' class="col-xs-12 homehead text-center">
                            {{ story.title | striptags }}<br>
                        </div>

                        <input id="title_holder" type="hidden" name='nucontent' value = " ">
                        <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value = "title">

                    </form>
                </div>
            </div>

            <div class="text-center" style="margin-top: 20px;">

                <a class="joslargelinkbutton joscursive" href="{% url "profile" story.author.id %}"
                   style=" padding: 10px 10px 0 10px;">
                    <span style="font-size: 48pt; margin-left: 5px; margin-right: 5px;">
                        {{ story.author.JOSProfile.jos_name }}
                    </span>
                </a>

            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="row" style=" ">

        <div class="col-xs-12">

            <div id='border_content' class="{% if edit %}edit_border{% endif %} edit_border_class"
                 style="padding: 3px;">

                <!-- Content Edit Buttons -->
                {% include "jos_editor.html" with section='content' %}

                <div class="row">
                    <form id='content_form' method="post" {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                        <div id='content' class="col-xs-12">
                            {{ story.content | richtext_filters | safe }}<br>
                        </div>

                        <input id="content_holder" type="hidden" name='nucontent' value=" ">
                        <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value="content">

                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Discussion -->
    <div id='discuss' style="margin-left: 30px; margin-top: 30px;">
        <span class="col-xs-12 homehead" style="font-size: 28pt;">Community discussion:</span><br>
    </div>

    <div class="row" style="">
        <div class="col-xs-11 col-xs-offset-1" style="margin-top: 20px;">

            {% for comment in comments %}

                {% if comment.sender != story.author %}

                    <div class="row">

                        <div class="row" style=" margin-top: 10px;">
                            <a href="{% url "profile" comment.sender.id %}"
                               style="margin-left: 15px; margin-right: 10px;">
                                <span style="font-size: 20pt; margin: 0 0 0 5px;">
                                    {{ comment.sender.JOSProfile.jos_name }}
                                </span>
                            </a> said:
                        </div>

                        <div class="row"
                             style="border-bottom: 1px dashed rgb(65, 45, 120);
                                    margin-top: 20px;
                                    padding-bottom: 10px;">

                            <div class="col-xs-1">

                                <img style="display: inline; height: 60px;" src="
                                    {% if profile.profile_image_idstr != "noimage1" %}
    http://res-4.cloudinary.com/desg88u7l/image/upload/{{ comment.sender.JOSProfile.profile_image_idstr }}
                                    {% else %}
                                        /static/img/coming-soon-profile.png
                                    {% endif %}">

                            </div>

                            <div class="col-xs-10"
                                 style="border: 1px solid rgb(65, 45, 120);
                                 font-size: 20pt;
                                 padding: 15px;">

                                "{{ comment.body | striptags | safe }}"

                            </div>
                        </div>
                    </div>

                {% else %}

                    <div class="row"
                         style="border-bottom: 1px dashed rgb(65, 45, 120);
                         margin-top: 20px; padding-bottom: 10px;">

                        <div class="col-xs-9 col-xs-offset-2"
                             style="border: 1px solid rgb(65, 45, 120); font-size: 20pt; padding: 15px;">
                            "{{ comment.body | striptags | safe }}"
                        </div>


                        <div class="col-xs-1">
                            <img style="display: inline; height: 60px;" src="
                                {% if profile.profile_image_idstr != "noimage1" %}
    http://res-4.cloudinary.com/desg88u7l/image/upload/{{ comment.sender.JOSProfile.profile_image_idstr }}
                                {% else %}
                                    /static/img/coming-soon-profile.png
                                {% endif %}">
                        </div>
                    </div>

                {% endif %}

            {% endfor %}
        </div>
    </div>

    <div class="row" style="">

        <div class="col-xs-10 col-xs-offset-1" style="margin-top: 20px;">

            <div id='border_comment' class="{% if edit %}edit_border{% endif %} edit_border_class"
                 style="padding: 3px;">

                <div class="col-xs-12" style="margin-top: 10px; margin-bottom: 10px;">

                    <a id="edit_comment"
                       class="btn btn-default"
                       style="margin-top: 25px; margin-left: 100px; width: 250px;"
                       onclick="manageCKEdit(this)"
                       data-toggle="tooltip"
                       title="Activates the word processor"
                       data-placement="right">
                        {% trans "Add your thought ..." %}
                    </a>

                    <button id="save_comment"
                            class="btn btn-success btn-xs pull-right"
                            style="display: none; margin-left: 5px; width: 80px;"
                            onclick="manageCKEdit(this)"
                            data-toggle="tooltip"
                            title="Will replace previous text"
                            data-placement="bottom">
                        <span style="font-size: 14pt;">Save</span>
                    </button>

                    <button id="discard_comment"
                            class="btn btn-danger btn-xs pull-right"
                            style="display: none; width: 80px;"
                            onclick="manageCKEdit(this)"
                            data-toggle="tooltip"
                            title="Will NOT save changes!"
                            data-placement="bottom">
                        <span style="font-size: 14pt;">Discard</span>
                    </button>

                </div>

                <form id='comment_form' method="post"
                      {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                    <div id='comment' class="col-xs-12">
                        {{ comment.body | striptags }}<br>
                    </div>

                    <input id="comment_holder" type="hidden" name='nucontent' value=" ">
                    <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value="comment">

                </form>

            </div>
        </div>
    </div>
</div>

<!-- Side Panel -->
<div id="editing_side_panel_hint"
     class="col-xs-2 fixed hidden"
     style="font-size: 18pt; margin-top: 90px;">
    Hint:<br>Choose "Discard" or "Save" to exit editing mode
</div>

<div id="editing_side_panel" class="col-xs-2 fixed">

    <div style="height: 70px; text-align: center;">
        {% if not edit %}
            <span class="joshint"
                  data-toggle="tooltip"
                  title="The story column on left scrolls"
                  data-placement="bottom">
                Hint: Story column scrolls
            </span>
        {% endif %}
    </div>

    {% include "updated.html" with myobj=story %}<br>

    {% if story.author == request.user %}

        <a id="edit_mode_button" class="btn pull-right btn-info"
           style="margin-top: 30px;"
                {% if edit %}
                    href="{% url "josstory" story.id %}">
                    {% trans "Hide edit" %}
                {% else %}
                    href="{% url "josstory_edit" story.id %}">
                    {% trans "Edit" %}
                {% endif %}
        </a><br>

        <a class="btn pull-right {% if story.publish %}btn-danger{% else %}btn-success{% endif %}"
           style="margin-top: 30px;"
                {% if story.publish %}
           href="{% url "josstory" story.id %}/?pub=remove">
                    {% trans "Unshare" %}
                {% else %}
                    href="{% url "josstory" story.id %}/?pub=publish">
                    {% trans "Publish" %}
                {% endif %}
        </a><br>

        <a class="btn pull-right btn-warning"
           style="margin-top: 30px;"
           href="{% url "mystory_list" %}">
            {% trans "Stories" %}
        </a>
    {% endif %}<br>

    {% if story.author != request.user %}

        <a class="btn pull-right btn-warning"
           style="margin-top: 30px;"
           href="{% url "story_gallery" %}">
            {% trans "Gallery" %}
        </a><br>

    {% endif %}

    {# comment #}
    <a class="btn pull-right btn-default"
       style="margin-top: 90px;" href="#discuss">
        {% trans "Discuss" %}
    </a><br>

</div>
</div>

<script>

    $(document).ready(function () {
        CKEDITOR.disableAutoInline = true;
        $('[data-toggle="tooltip"]').tooltip();
       });

</script>

{% endblock %}



