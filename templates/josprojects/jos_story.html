{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags  static %}

{% block meta_title %}{{ story.title | striptags  | safe | truncatechars:25 }}{% endblock %}
{% block title %}{{ story.title | striptags  | safe | truncatechars:25 }}{% endblock %}
{% block breadcrumb_menu %}{{ block.super }}
    {{ story.title  | striptags | safe | truncatechars:55 }} <span style="font-size: 18pt; font-style: italic; margin-left: 5px;"> by {{ story.author.JOSProfile.friendly_jos_name }}</span>
{% endblock %}

{% block all_content %}

<style>
    #author, #author:visited {
        background-color: white;
        color: rgb(112, 154, 109);
    }

    #author:focus, #author:hover {color: #e38d13; outline: 2px dashed #e38d13}

    .cke { margin-left: 25px;}

    .fixed {
        height: 600px;
        overflow: hidden;
    }

    .scrollit {
        overflow-y: scroll;
    }

    .desk-button {
        display: block;
        font-size: 16pt;
        min-height: 50px;
        margin-top: 20px;
        padding-top: 10px;
    }

</style>

<div class="row" style="margin-top: 0;">

<!-- Main Panel -->
<div class="col-xs-10 scrollit" style="border-right: 1px solid rgb(65, 45, 120); min-height: 850px;">

    <div style="height: 30px; margin-bottom: 10px; margin-left: 15px;">

        <span class="joshint"
              style="{% if not edit %}display: none;{% endif %} font-size: 16pt;"
              data-toggle="tooltip"
              title="Dragging bottom right triangle changes the editor's height"
              data-placement="bottom">
        Hint: Drag to change editor height;  contact us if you unintentionally erase anything
        </span>
    </div>

    <!-- Title -->
    <div class="row" style=" ">
        <div class="col-xs-12">

            <div id='border_title'
                 class="{% if edit %}edit_border{% endif %} edit_border_class"
                 style="padding: 3px;">

                <!-- Title Edit Buttons -->
                {% include "josprojects/../jos_editor.html" with section='title' %}

                <div class="row">
                    <form id='title_form'
                          method="post"
                          {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                        <div id='title' class="col-xs-12 homehead text-center">
                            {{ story.title | striptags | safe }}<br>
                        </div>

                        <input id="title_holder" type="hidden" name='nucontent' value = " ">
                        <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value = "title">

                    </form>
                </div>
            </div>

            <div class="text-center" style="margin-top: 10px; padding-top: 10px;">

                <a id="author" class="joslargelinkbutton joscursive" href="{% url "profile" story.author.id %}"
                   style="padding: 0">
                    <span style="font-size: 48pt; margin: 0 15px;">
                        {{ story.author.JOSProfile.friendly_jos_name }}
                    </span>
                </a>

            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="row" style=" ">

        <div class="col-xs-12">

            <div id='border_content' class="{% if edit %}edit_border{% endif %} edit_border_class"
                 style="padding: 3px;">

                <!-- Content Edit Buttons -->
                {% include "josprojects/../jos_editor.html" with section='content' %}

                <div class="row">
                    <form id='content_form' method="post" {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                        <div id='content' class="col-xs-12">
                            {{ story.content | richtext_filters | safe }}<br>
                        </div>

                        <input id="content_holder" type="hidden" name='nucontent' value=" ">
                        <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value="content">

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Side Panel Controls -->
<div id="editing_side_panel" class="col-xs-2" style=" ">

    {% include "josprojects/updated_include.html" with myobj=story %}<br>

    <!-- Go To Discuss -->
    <a class="btn pull-right btn-default"
       style="margin-top: 20px;" href="#discuss">
        {% trans "Discuss" %}
    </a><br>

    {% if story.author == request.user %}

        <!-- Edit -->
        <a id="edit_mode_button" class="btn pull-right btn-info"
           style="margin-top: 15px;"
                {% if edit %}
                    href="{% url "josstory" story.id %}">
                    {% trans "Hide" %}
                {% else %}
                    href="{% url "josstory_edit" story.id %}">
                    {% trans "Edit" %}
                {% endif %}
        </a><br>

        <!-- Share slider -->
        <div class='row text-center' style="margin-top: 145px;">
            <span class="homehead" style="font-size: 20pt;">Sharing</span>

            <div class='text-left' style="margin: 25px 0 0 30px;">

                <input name="permission_slider" title='permission_slider' id="sharing_slider">

            </div>

        </div>

    {% endif %}

    {% include 'josprojects/library_include.html' %}

</div>

<!-- Discussion -->
<div class="row">

    <div class="col-xs-12">

        <div id="discuss" class="homehead" style="font-size: 28pt; margin-left: 30px; margin-top: 0;">
            Community discussion:
        </div>

        <div class="row" style="">
            <div class="col-xs-11 col-xs-offset-1" style="margin-top: 20px;">

                {% for comment in comments %}

                    <div class="row" style="color: rgb(217,83,79); font-size: 20pt; margin-top: 20px;">
                        <div class="col-xs-3">
                            {{ comment.sent_at | date:"M d" }}; {{ comment.sent_at | time:"f A" }}
                        </div>
                    </div>

                    <div class="row" style="font-size: 20pt; margin-top: 20px;">

                        {% if comment.sender != request.user %}

                            <div class="col-xs-2" style="padding: 0;">
                                {% include "josmembers/user_picture_include.html" with user=comment.sender height=60 %}
                            </div>

                            <div class="col-xs-9"
                                 style="margin-left: -45px; border: 1px solid rgb(65, 45, 120); padding: 15px; min-height: 103px;">
                                "{{ comment.body | striptags | safe }}"
                            </div>

                        {% else %}

                            <div class="col-xs-9"
                                 style="border: 1px solid rgb(65, 45, 120); padding: 15px;  min-height: 103px;">
                                "{{ comment.body | striptags | safe }}"
                            </div>

                            <div class="col-xs-2">
                                {% include "josmembers/user_picture_include.html" with user=comment.sender height=60 %}
                            </div>

                        {% endif %}

                    </div>

                {% endfor %}
            </div>
        </div>

        <div class="row" style="">

            <div class="col-xs-10 col-xs-offset-1" style="margin-top: 10px;">

                <div id='border_comment' class="edit_border_class"
                     style="padding: 3px;">

                    <div class="col-xs-12" style="margin-top: 10px; margin-bottom: 10px;">

                        <a id="edit_comment"
                           class="btn btn-default edit_section_button"
                           style="margin-top: 15px; margin-left: 30px; width: 250px;"
                           onclick="handleCKEdit(this)"
                           data-toggle="tooltip"
                           title="Activates the word processor"
                           data-placement="right">
                            Add your thought ...
                        </a>

                        <button id="save_comment"
                                class="btn btn-success btn-xs pull-right"
                                style="display: none; margin-left: 5px; width: 80px;"
                                onclick="handleCKEdit(this)"
                                data-toggle="tooltip"
                                title="Will replace previous text"
                                data-placement="bottom">
                            <span style="font-size: 14pt;">Save</span>
                        </button>

                        <button id="discard_comment"
                                class="btn btn-danger btn-xs pull-right"
                                style="display: none; width: 80px;"
                                onclick="handleCKEdit(this)"
                                data-toggle="tooltip"
                                title="Will NOT save changes!"
                                data-placement="bottom">
                            <span style="font-size: 14pt;">Discard</span>
                        </button>

                    </div>

                    <form id='comment_form' method="post"
                          {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>

                        <div id='comment' class="col-xs-12">
                            {{ comment.body | striptags }}<br>
                        </div>

                        <input id="comment_holder" type="hidden" name='nucontent' value=" ">
                        <input id="field_to_edit_holder" type="hidden" name="field_to_edit" value="comment">

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script>

    $("#sharing_slider").slider({
                id: "slider13",
                handle: 'triangle',
                max: 3,
                min: 1,
                orientation: "vertical",
                snap_bounds: 20,
                step: 1,
                ticks: [1, 2, 3],
                ticks_labels: ["Only me", "My team", "Publish"],
                tooltip: "hide",
                value: {{ story.publish_permission }}
            })
            .on('slideStop', function (slideStopEvt) {
                window.location.href = "{% url "josstory" story.id %}/?pubperm=" + slideStopEvt.value;
            });

    $(document).ready(function () {
        CKEDITOR.disableAutoInline = true;
        $('[data-toggle="tooltip"]').tooltip();
    });

</script>


{% endblock %}




