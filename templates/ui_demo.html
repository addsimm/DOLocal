{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags  static %}
{% block meta_title %}}Slots of Fun{% endblock %}
{% block title %}}Slots of Fun{% endblock %}
{% block breadcrumb_menu %}
    {{ block.super }}Slots of Fun{% endblock %}

{% block footer %}{% endblock %}

{% block all_content %}

<style>

    ul {
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .jSlots-wrapper {
        overflow: hidden;
        height: 20px;
        display: inline-block; /* to size correctly, can use float too, or width*/
        border: 1px solid #999;
    }

    .slot {
        float: left;
    }

    /* FANCY EXAMPLE */
    .fancy .jSlots-wrapper {
        overflow: hidden;
        height: 100px;
        display: inline-block; /* to size correctly, can use float too, or width*/
        border: 1px solid #999;
    }

    .fancy .slot li {
        width: 100px;
        line-height: 100px;
        text-align: center;
        font-size: 70px;
        font-weight: bold;
        color: #fff;
        text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.8);
        font-family: 'Gravitas One', serif;
        border-left: 1px solid #999;
    }

    .fancy .slot:first-child li {
        border-left: none;
    }

    .fancy .slot li:nth-child(7) {
        background-color: #FFCE29;
    }

    .fancy .slot li:nth-child(6) {
        background-color: #FFA22B;
    }

    .fancy .slot li:nth-child(5) {
        background-color: #FF8645;
    }

    .fancy .slot li:nth-child(4) {
        background-color: #FF6D3F;
    }

    .fancy .slot li:nth-child(3) {
        background-color: #FF494C;
    }

    .fancy .slot li:nth-child(2) {
        background-color: #FF3333;
    }

    .fancy .slot li:nth-child(1),
    .fancy .slot li:nth-child(8) {
        background-color: #FF0000;
    }

    .fancy .slot li span {
        display: block;
    }

    /* ANIMATIONS */

    @-webkit-keyframes winner {
        0%, 50%, 100% {
            -webkit-transform: rotate(0deg);
            font-size: 70px;
            color: #fff;
        }
        25% {
            -webkit-transform: rotate(20deg);
            font-size: 90px;
            color: #FF16D8;
        }
        75% {
            -webkit-transform: rotate(-20deg);
            font-size: 90px;
            color: #FF16D8;
        }
    }

    @-moz-keyframes winner {
        0%, 50%, 100% {
            -moz-transform: rotate(0deg);
            font-size: 70px;
            color: #fff;
        }
        25% {
            -moz-transform: rotate(20deg);
            font-size: 90px;
            color: #FF16D8;
        }
        75% {
            -moz-transform: rotate(-20deg);
            font-size: 90px;
            color: #FF16D8;
        }
    }

    @-ms-keyframes winner {
        0%, 50%, 100% {
            -ms-transform: rotate(0deg);
            font-size: 70px;
            color: #fff;
        }
        25% {
            -ms-transform: rotate(20deg);
            font-size: 90px;
            color: #FF16D8;
        }
        75% {
            -ms-transform: rotate(-20deg);
            font-size: 90px;
            color: #FF16D8;
        }
    }

    @-webkit-keyframes winnerBox {
        0%, 50%, 100% {
            box-shadow: inset 0 0 0px yellow;
            background-color: #FF0000;
        }
        25%, 75% {
            box-shadow: inset 0 0 30px yellow;
            background-color: aqua;
        }
    }

    @-moz-keyframes winnerBox {
        0%, 50%, 100% {
            box-shadow: inset 0 0 0px yellow;
            background-color: #FF0000;
        }
        25%, 75% {
            box-shadow: inset 0 0 30px yellow;
            background-color: aqua;
        }
    }

    @-ms-keyframes winnerBox {
        0%, 50%, 100% {
            box-shadow: inset 0 0 0px yellow;
            background-color: #FF0000;
        }
        25%, 75% {
            box-shadow: inset 0 0 30px yellow;
            background-color: aqua;
        }
    }

    .winner li {
        -webkit-animation: winnerBox 2s infinite linear;
        -moz-animation: winnerBox 2s infinite linear;
        -ms-animation: winnerBox 2s infinite linear;
    }

    .winner li span {
        -webkit-animation: winner 2s infinite linear;
        -moz-animation: winner 2s infinite linear;
        -ms-animation: winner 2s infinite linear;
    }

</style>

<div style="margin: 50px 0 0 50px;">
    <ul class="slot">
        <li>1</li>
        <li>2</li>
        <li>3</li>
        <li>4</li>
        <li>5</li>
        <li>6</li>
        <li>7</li>
    </ul>
    <input type="button" id="playNormal" value="play">
</div>

<div class="fancy" style="margin-top: 100px;">
    <ul class="slot">
        <!-- In reverse order so the 7s show on load -->
        <li><span>7</span></li>
        <li><span>6</span></li>
        <li><span>5</span></li>
        <li><span>4</span></li>
        <li><span>3</span></li>
        <li><span>2</span></li>
        <li><span>1</span></li>
    </ul>
    <input type="button" id="playFancy" value="Play">
</div>

<script src="{% static '/js/jquery.easing.1.3.js' %}"></script>
<script>

    (function ($) {

        $.jSlots = function (el, options) {

            var base = this;

            base.$el = $(el);
            base.el = el;

            base.$el.data("jSlots", base);

            base.init = function () {

                base.options = $.extend({}, $.jSlots.defaultOptions, options);

                base.setup();
                base.bindEvents();

            };

            // DEFAULT OPTIONS
            $.jSlots.defaultOptions = {
                number: 3,          // Number: # of slots
                winnerNumber: 1,    // Number / Array: number(s) trigger a win - NOT 0 BASED
                spinner: '',        // CSS Selector: element binding start
                spinEvent: 'click', // String: event to start slots
                onStart: $.noop,    // Function: runs on spin start,
                onEnd: $.noop,
                // Function: run on spin end, passed (finalNumbers:Array).
                // finalNumbers gives index of li each slot stopped in order.
                onWin: $.noop,
                // Function: run on winning number.
                // It is passed (winCount:Number, winners:Array)
                easing: 'swing',    // String: easing type for final spin
                time: 7000,         // Number: total time of spin animation
                loops: 6            // Number: times spun during animation
            };

            // HELPERS
            base.randomRange = function (low, high) {
                return Math.floor(Math.random() * (1 + high - low)) + low;
            };

            // VARS
            base.isSpinning = false;
            base.spinSpeed = 0;
            base.winCount = 0;
            base.doneCount = 0;

            base.$liHeight = 0;
            base.$liWidth = 0;

            base.winners = [];
            base.allSlots = [];

            // FUNCTIONS
            base.setup = function () {

                // set sizes

                var $list = base.$el;
                var $li = $list.find('li').first();

                base.$liHeight = $li.outerHeight();
                base.$liWidth = $li.outerWidth();

                base.liCount = base.$el.children().length;

                base.listHeight = base.$liHeight * base.liCount;

                base.increment = (base.options.time / base.options.loops) / base.options.loops;

                $list.css('position', 'relative');

                $li.clone().appendTo($list);

                base.$wrapper = $list.wrap('<div class="jSlots-wrapper"></div>').parent();

                // remove original, so it can be recreated as a Slot
                base.$el.remove();

                // clone lists
                for (var i = base.options.number - 1; i >= 0; i--) {
                    base.allSlots.push(new base.Slot());
                }

            };

            base.bindEvents = function () {
                $(base.options.spinner).bind(base.options.spinEvent, function (event) {
                    if (!base.isSpinning) {
                        base.playSlots();
                    }
                });
            };

            // Slot constructor
            base.Slot = function () {

                this.spinSpeed = 0;
                this.el = base.$el.clone().appendTo(base.$wrapper)[0];
                this.$el = $(this.el);
                this.loopCount = 0;
                this.number = 0;

            };


            base.Slot.prototype = {

                // do one rotation
                spinEm: function () {

                    var that = this;

                    that.$el
                            .css('top', -base.listHeight)
                            .animate({'top': '0px'}, that.spinSpeed, 'linear', function () {
                                that.lowerSpeed();
                            });

                },

                lowerSpeed: function () {

                    this.spinSpeed += base.increment;
                    this.loopCount++;

                    if (this.loopCount < base.options.loops) {

                        this.spinEm();

                    } else {

                        this.finish();

                    }
                },

                // final rotation
                finish: function () {

                    var that = this;

                    var endNum = base.randomRange(1, base.liCount);

                    var finalPos = -( (base.$liHeight * endNum) - base.$liHeight );
                    var finalSpeed = ( (this.spinSpeed * 0.5) * (base.liCount) ) / endNum;

                    that.$el
                            .css('top', -base.listHeight)
                            .animate({'top': finalPos}, finalSpeed, base.options.easing, function () {
                                base.checkWinner(endNum, that);
                            });

                }

            };

            base.checkWinner = function (endNum, slot) {

                base.doneCount++;
                // set the slot number to whatever it ended on
                slot.number = endNum;

                // if its in the winners array
                if (
                        ( $.isArray(base.options.winnerNumber) && base.options.winnerNumber.indexOf(endNum) > -1 ) ||
                        endNum === base.options.winnerNumber
                ) {

                    // its a winner!
                    base.winCount++;
                    base.winners.push(slot.$el);

                }

                if (base.doneCount === base.options.number) {

                    var finalNumbers = [];

                    $.each(base.allSlots, function (index, val) {
                        finalNumbers[index] = val.number;
                    });

                    if ($.isFunction(base.options.onEnd)) {
                        base.options.onEnd(finalNumbers);
                    }

                    if (base.winCount && $.isFunction(base.options.onWin)) {
                        base.options.onWin(base.winCount, base.winners, finalNumbers);
                    }
                    base.isSpinning = false;
                }
            };


            base.playSlots = function () {

                base.isSpinning = true;
                base.winCount = 0;
                base.doneCount = 0;
                base.winners = [];

                if ($.isFunction(base.options.onStart)) {
                    base.options.onStart();
                }

                $.each(base.allSlots, function (index, val) {
                    this.spinSpeed = 0;
                    this.loopCount = 0;
                    this.spinEm();
                });

            };


            base.onWin = function () {
                if ($.isFunction(base.options.onWin)) {
                    base.options.onWin();
                }
            };


            // Run initializer
            base.init();
        };

        // JQUERY FN
        $.fn.jSlots = function (options) {
            if (this.length) {
                return this.each(function () {
                    (new $.jSlots(this, options));
                });
            }
        };

    })(jQuery);

    // normal example
    $('.slot').jSlots({
        spinner: '#playNormal',
        winnerNumber: 7
    });

    // fancy example
    $('.fancy .slot').jSlots({
        number: 7,
        winnerNumber: 1,
        spinner: '#playFancy',
        easing: 'easeOutSine',
        time: 7000,
        loops: 6,
        onStart: function () {
            $('.slot').removeClass('winner');
        },
        onWin: function (winCount, winners) {
            // only fires if you win

            $.each(winners, function () {
                this.addClass('winner');
            });

            // react to the # of winning slots
            if (winCount === 1) {
                //alert('You got ' + winCount + ' 7!!!');
            } else if (winCount > 1) {
                //alert('You got ' + winCount + ' 7’s!!!');
            }

        }
    });

</script>

{% endblock all_content %}




