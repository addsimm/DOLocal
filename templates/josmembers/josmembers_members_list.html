{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags cloudinary %}
{% cloudinary_includes %}

{% block meta_title %}{{ user.JOSProfile.friendly_jos_name }}{% endblock %}
{% block title %}{{ user.JOSProfile.friendly_jos_name }}{% endblock %}
{# block body_id }account{ endblock #}

{% block breadcrumb_menu %}

    {{ block.super }}
    {{ user.get_short_name }}'s Community

{% endblock %}

{% block all_content %}

    <div class="josinstructions" style="margin-top: 15px;"><b>My teams:</b></div>

    <!-- Teams -->
    <div class="row">

        <div class="col-xs-12">

            {% if teams_list %}
                {% for team_dict in teams_list %}

                    <div class="row" style="margin-top: 20px;
                                            padding: 10px 0;
                                            border: solid 1px rgb(209,209,209);
                                            {% if forloop.counter|divisibleby:2 %}
                                                background-color: rgb(209,209,209);
                                            {% endif %}">
                        <div class="col-xs-3 text-center" style="font-size: 24pt; font-weight: bold; margin-left: -50px; padding: 0;">
                            {{ team_dict.name }}<br>

                            <button class="j_button j_action_button"
                               style="margin: 15px 0 0 0;"
                               onclick="window.location.href='{% url 'josmessages:messages_compose' %}/?team={{ team_dict.name }}';">
                                MESSAGE
                            </button>

                        </div>

                        <div class="col-xs-9" style="margin-left: -30px; padding: 0;">

                            {% for usr in team_dict.users %}

                                {% include "josmembers/user_picture_include.html" with user=usr height=64 %}

                            {% endfor %}

                        </div>
                    </div>

                {% endfor %}


            {% else %}
                -- Join a team?
            {% endif %}
        </div>
    </div>

    <div class="josinstructions" style="margin-top: 30px;"><b>My favorites:</b></div>

    <!-- Favorites -->
    <div class="row">
        <div class="col-xs-12" style="margin-top: 15px;">

            {% if  following.count > 0 %}

                    {% for favorite in following %}

                        <div class="col-xs-3 text-center" style="padding: 10px; margin: 0 15px 15px 0; width: 256px; border: 1px solid rgb(65,45,120);">
                            {% include "josmembers/user_picture_include.html" with user=favorite height=128 %}<br>

                            <button class="j_button j_action_button"
                               style="font-size: 14px; margin: 10px 0 0 0;"
                               onclick="window.location.href='{% url 'josmessages:messages_compose' favorite.id %}';">
                                MESSAGE
                            </button>

                            <button class="j_button j_action_button"
                               style="font-size: 14px; margin: 10px 0 0 10px;"
                               onclick="window.location.href='{% url 'josmembers:josmembers_list' %}/?remove_favorite={{ favorite.id }}';">
                                UNFAVOR
                            </button>

                        </div>
                    {% endfor %}

            {% else %}
                -- Favorite someone?
            {% endif %}
        </div>
    </div>

    <div class="josinstructions" style="margin-top: 30px;"><b>Search for friends:</b></div>

    <!-- Search -->
    <div class="row" style="margin-top: 15px;">

        <div class="col-xs-12" style="padding-left: 85px;">
            <div class="josinstructions">Please begin typing a name. The computer starts responding after two letters.</div>


            <input id="member_search_text" style="font-size: 20pt; margin-top: 20px; padding: 5px; width: 300px;" type="text" placeholder="Start typing here">

            <button class="j_button j_back_button"
               style="margin-left: 5px;"
               onclick="window.location.href='{% url "josmembers:josmembers_list" %}';">
                START OVER
            </button>

            <div id="member_search_results"></div>

        </div>
    </div>

<script>
    /* Before our JavaScript, the urls need to be set. */
    var SUBMIT_URL_PAL = "{% url 'josmembers:search_member_list' %}";

        /** Executes a search  */
    var processSearchPal = function () {
        //Get and trim the search text.
        var searchText = $('#member_search_text').val().trim().toLowerCase();

        if (searchText.length < 2) {
            //Too short. Ignore the submission, and erase any current results.
            $('#member_search_results').html("<i>Keep typing ...</i>");

        } else {
            // Execute the search.
            var processServerResponsePal = function (serverResponse_data) // textStatus_ignored, jqXHR_ignored)
                {
                    $('#member_search_results').html(serverResponse_data);
                };

            var config = {
                type: "GET",
                url: SUBMIT_URL_PAL,
                data: {
                    'member_search_text': searchText
                },
                dataType: 'html',
                success: processServerResponsePal,
                fail: function () {
                    alert("Fail")
                }
            };
            $.ajax(config);
        }
    };

    /** The Ajax "main" function. */

    var MILLS_TO_IGNORE_SEARCH = 100;
    $(document).ready(function () {
        /* This attaches a listener. Calling this again would attach a *second* */
        $('#member_search_text').keyup(_.debounce(processSearchPal,
                MILLS_TO_IGNORE_SEARCH, true));
    });

</script>

{% endblock all_content %}






