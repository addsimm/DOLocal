{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags cloudinary static %}

{% block meta_title %}
    {{ profile.user.get_short_name }} Profile
{% endblock %}
{% block title %}
    {{ profile.user.get_short_name }} Profile
{% endblock %}
{# block body_id }account{ endblock #}

{% block breadcrumb_menu %}
    {{ block.super }}
    {{ profile.user.get_short_name }}'s Profile
{% endblock %}

{% block all_content %}

<style>

    .change-image {
        font-size: 12pt;
        margin-top: 0;
        outline: none;
        text-decoration: none;
    }

</style>

<div class="row" style="margin-top: 50px;">

<!-- Left Panel -->
<div class="col-xs-10 scrollit" style="border-right: 1px solid rgb(65, 45, 120);">

    <!-- Image -->
    <div class="row">

        <div class="col-xs-4 text-center" style="padding: 5px;">

            <div style="{% if edit %}outline: 3px dashed #28a4c9;{% endif %} padding: 10px;">

                {% if "noimage" in profile.profile_image_id_str %}
                    <img class="img-responsive" style="height: 256px;" src="{% static '/static/img/peeky-102216.png' %}">
                {% else %}
                    <img class="img-responsive" style="height: 256px;"
                         src="https://res-4.cloudinary.com/desg88u7l/image/upload/{{ profile.profile_image_id_str }}">
                {% endif %}

            </div>

            {% if edit %}

                {% cloudinary_includes %}

                <script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>

                <script type="text/javascript">
                    var publicid = "{{ potentialNewProfileImageIdStr }}";
                    $(function () {
                        $('#upload_widget_opener').cloudinary_upload_widget(
                                {
                                    cloud_name: 'desg88u7l',
                                    upload_preset: 'b1wbumye',
                                    theme: 'minimal',
                                    sources: ['local','camera'],
                                    multiple: false,
                                    public_id: publicid,
                                    tags: ['profile_image', '{{ profile.user.username }}'],
                                    client_allowed_formats: ["png", "gif", "jpeg"],
                                    max_file_size: 350000,
                                    button_class: 'btn btn-info change-image',
                                    button_caption: '<span class="glyphicon glyphicon-camera"></span><span style = "margin-left: 7px;" > Change</span>',
                                    show_powered_by: false},

                                function (error, result) { // < Callback
                                    console.log(error, result);
                                    if (typeof result != 'undefined') {
                                        window.location.href = "/users/{{ profile.user.id }}/?new_image=True";
                                    }
                                });
                    });
                </script>

                <button id="upload_widget_opener"></button>

            {% endif %}

        </div>

        <!-- Member name -->
        <div class="col-xs-7 text-center" style="margin-top: 80px;">
            <span class="joscursive" style="font-size: 72pt; font-weight: bold;">About {{ profile.user.get_short_name }}</span>
        </div>

    </div>

    <!-- Aboutme -->
    <div style="position: relative; top: 15px; width: 920px; height: 415px; left: 0;">

        {% if edit %}

            <a id="about_edit_btn"
               class="btn btn-info btn-xs pull-right edit_section_button"
               style="font-size: 14pt; position: absolute; top: -31px; right: 0; width: 125px;"
               onclick="josCKEdit('about');"
               data-toggle="tooltip"
               data-placement="bottom"
               title="Activates editor"
            >
                Edit about
            </a>

            <a id="about_cancel_btn"
               class="btn btn-danger btn-xs pull-right edit_section_button"
               style="font-size: 14pt; position: absolute; top: -31px; width: 125px; right: 135px;  display: none;"
               onclick="josCKDestroy('about');"
               data-toggle="tooltip"
               data-placement="bottom"
               title="Warning: discards recent changes!"
            >
                Discard
            </a>


            <!-- This div holds editor. -->
            <div id="about_editor_container" style="width: 920px;"></div>

        {% endif %}

        <!-- This div displays contents. -->
        <div id="about_original_content" class="{% if edit %}edit_border{% endif %} edit_border_class"
             style="padding: 20px; width: 920px; min-height: 415px;">
            {{ profile.about_me | safe }}<br>
        </div>
    </div>
</div>

<!-- Side panel -->
<div id="editing_side_panel_hint"
     class="col-xs-2 fixed hidden"
     style="font-size: 18pt; margin-top: 90px;">
    Hint:<br>Choose "Discard" or "Save" to exit editing mode
</div>

<div id="editing_side_panel" class="col-xs-2 fixed" style="">

    <div style="height: 70px; text-align: center;">
        <span class="joshint"
              data-toggle="tooltip"
              title="The column on left scrolls"
              data-placement="bottom">
            Hint: Left column scrolls
        </span>
    </div>

    {% include "josprojects/updated_include.html" with myobj=profile %}

    {% if profile.user == request.user %}

        <a id="edit_mode_button" class="btn pull-right btn-info"
           style="margin-top: 30px;"
                {% if edit %}
           href="{% url "josmembers:josprofile" request.user.id %}">
                    {% trans "Hide" %}
                {% else %}
                    href="{% url "josmembers:josprofile_edit" request.user.id %}">
                    {% trans "Edit" %}
                {% endif %}
        </a><br>

    {% else %}

        <a class="btn pull-right btn-default"
           style="margin-top: 30px;"
           href="/messages/compose/{{ profile.user.id }}">
            Message
        </a>

        {% if requesterfollows %}

            <a class="btn pull-right  btn-default"
               style="margin-top: 30px;"
               href="{% url 'josmembers:josmembers_list' %}/?remove_favorite={{ profile.user.id }} ">
                Unfavor
            </a>

        {% else %}

            <a class="btn pull-right btn-default"
               style="margin-top: 30px;"
               href="{% url 'josmembers:josmembers_list' %}/?add_favorite={{ profile.user.id }} ">
                Favor
            </a>

        {% endif %}

    {% endif %}

</div>
</div>

<script>

    $(document).ready(function () {
        initJOSEditor('about', 'large', 'member_profile_update', "{{ profile.about_me | escapejs }}");
        $('[data-toggle="tooltip"]').tooltip();
    });

</script>
{% endblock %}
