{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags  static %}
{% block meta_title %}{{ story.title | striptags | safe | truncatechars:25 }}{% endblock %}
{% block title %}{{ story.title | striptags  | safe | truncatechars:25 }}{% endblock %}
{% block breadcrumb_menu %}
    {{ block.super }}{{ story.title  | striptags | safe | truncatechars:120 }}{% endblock %}

{% block footer %}{% endblock %}

{% block all_content %}

    <style>

        input {
            display: none;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            top: 3px;
            margin-left: 10px;
            height: 40px;
            width: 100px;
            outline: 2px solid #412d78;
        }

        /* Slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: white;
        }

        .slider:before {
            position: absolute;
            color: white;
            font-size: 14pt;
            text-align: center;
            content: "OFF";
            top: 0;
            left: 0;
            height: 40px;
            width: 50px;
            padding-top: 7px;
            background-color: #5bc0de;
        }

        input:checked + .slider {
            background-color: #5cb85c;
        }

        input:checked + .slider:before {
            transform: translateX(50px);
            content: "ON";
        }

        /* three way */

        .three_label {
            background-color: white;
            font-size: 14pt;
            text-align: center;
            height: 40px;
            width: 100px;
            padding-top: 7px;
            color: #5bc0de;
            cursor: pointer;
        }

        .not-checked {
            color: #5bc0de;
            background-color: white;
        }

        .input-checked {
            background-color: #5bc0de !important;
            color: white !important;
        }

        /* Sho tools checkbox */
        .check_container label:before {
            position: absolute;
            top: 6px;
            left: 750px;
            content: " ";
            width: 44px;
            height: 44px;
            background-color: transparent;
            border: 5px solid #412d78;
            transition: border-color .2s;
        }

        .check_container label:hover::before {
            border: 5px dotted #f0ad4e;
        }

        .check_container label:hover {
            color: #f0ad4e;
        }

        #left_tools button {
            margin-left: 10px;
        }

    </style>

    <div id="left_tools" style="background-color: aliceblue; visibility: hidden;
        position: absolute; top: 0; left: 5px; height: 55px; width: 547px;
        display: flex; justify-content: flex-start; align-items: flex-end;">

        <button class="j_button_small j_info_button"
                onclick=" ">
            <i class="fa fa-circle fa-fw"></i>
            WHEEL
        </button>

        <button class="j_button_small j_relocate_button"
                onclick=" ">
            <i class="fa fa-square fa-fw"></i>
            VERSIONS
        </button>

        <button class="j_button_small j_action_button"
                onclick=" ">
            <i class="fa fa-scissors fa-fw"></i>
            RE-TITLE
        </button>

        <button class="j_button_small j_action_button"
                onclick=" ">
            <i class="fa fa-exclamation fa-fw"></i>
            READ / SEND
        </button>
    </div>

    <div id="right_tools" style="background-color: aliceblue; visibility: visible;
         position: absolute; top: 0; left: 550px; height: 55px; width: 600px;
         display: flex; justify-content: flex-start; align-items: center;
         padding-top: 5px;">

        <div style="font-size: 12pt; font-weight: bold; text-align: right; margin-left: 15px;">
            Auto<br>save:
        </div>

        <label class="switch">
            <input type="checkbox">
            <div class="slider"></div>
        </label>

        <div style="font-size: 12pt; font-weight: bold;
             margin-left: 25px; text-align: right">
            Shared<br>with:
        </div>

        <div id="sharing_box" style="
             position: relative; top:0; margin-left: 10px;
             height: 40px; width: 310px;
             outline: 2px solid #412d78;">

            <label id="perm_1" class="three_label">
                <input type="radio" name="toggle">ONLY ME
            </label>

            <label id="perm_2" class="three_label">
                <input type="radio" name="toggle">CIRCLES
            </label>

            <label id="perm_3" class="three_label">
                <input type="radio" name="toggle">PUBLISH
            </label>

        </div>

    </div>

    {% if story.author == request.user %}
        <button id='tools_tab' class="j_button j_info_button" style="
                position: absolute; top: 18px; left: 1155px; width: 125px;
                font-size: 14pt; border-radius: 0;"
            onclick="toolsTabHandler(this.id);"
            data-toggle="tooltip" data-placement="bottom"
            title="Shows toolbar">
        <i class="fa fa-cogs fa-fw" style="margin-right: 5px;"></i>
        TOOLS
    </button>
    {% endif %}

    <div style="margin: 60px 0 0 30px; display: flex; justify-content: flex-start; align-items: center;">

        <button id="content_edit_btn" class="j_button_small j_save_button"
                style=" " onclick="josCKEdit('story_content');"
                data-toggle="tooltip" data-placement="bottom"
                title="Updates content">
            <i class="fa fa-arrow-circle-up fa-fw"></i>
            SAVE STORY NOW
        </button>

        <button id="content_discard_btn" class="j_button_small j_discard_button"
                style="margin-left: 5px;"
                onclick="window.location.href = 'https://joinourstory.com/joscourses/josstory/' + {{ story.id }};"
                data-toggle="tooltip" data-placement="bottom"
                title="Reloads recent save and discards changes">
            <i class="fa fa-trash fa-fw"></i>
            RESTART EDIT SESSION
        </button>

        <div style="margin-left: auto;">
            {% include "josprojects/../jos_includes/updated_include.html" with myobj=story %}
        </div>

        <!-- Go To Discuss -->
        <button class="j_button_small j_relocate_button" style="margin-left: 15px;"
                onclick="window.location.href='#discuss';">
            <i class="fa fa-comments fa-fw"></i>
            DISCUSS
        </button>
    </div>

    <!-- Content -->
    <div style="margin: 5px 0 0 30px; background-color: pink; min-height: 500px;">

    <!-- This div holds editor. -->
    <div id="content_editor_container" style=" "></div>


    </div>




<script>

    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
        if (Number(window.location.href.split('/')[5]) === 0) {
            reload_url = 'https://joinourstory.com/joscourses/josstory/' + {{ story.id }};
            window.location.href = reload_url;
        }

        initJOSEditor('story_content', 'large', '/joscourses/story_update/?id=' + '{{ story.id }}', "{{ story.content | escapejs }}");
        initJOSEditor('comment', 'small', '/joscourses/story_update/?id=' + '{{ story.id }}', " ");
        josCKEdit('story_content');

    });


    var labels = $('#sharing_box').children();
    $(labels).click(function () {
        window.location.href =
            "{% url "joscourses:josstory" story.id %}/?pubperm=" + this.id.split("_")[1];
        $(this).addClass('input-checked').removeClass('not-checked');
        $(this).siblings().removeClass('input-checked').addClass('not-checked');
    });

    function toolsTabHandler(i) {
        var tools_tab = document.getElementById(i);
        console.log('tools_tab clicked: ' + $(tools_tab).attr('class').split(" "));

        if ($(tools_tab).hasClass('j_info_button')) {
            $(tools_tab)
                    .html("<i class='fa fa-cogs fa-fw' style='margin-right: 5px;'></i>CLOSE")
                    .addClass("isopen j_back_button")
                    .removeClass("isclosed j_info_button")
                    .attr("data-original-title", "Hides toolbar");
            $("#right_tools").css({opacity: 0, visibility: "visible"}).animate({opacity: 1}, 1000);
            $("#left_tools").css({opacity: 0, visibility: "visible"}).animate({opacity: 1}, 1000);
        } else {
            $(tools_tab)
                    .html("<i class='fa fa-cogs fa-fw' style='margin-right: 5px;'></i>TOOLS")
                    .addClass("isclosed j_info_button")
                    .removeClass("isopen j_back_button")
                    .attr("data-original-title", "Shows toolbar");
            $("#right_tools").css({visibility: "hidden"});
            $("#left_tools").css({visibility: "hidden"});
        }
    }

</script>

{% endblock all_content %}


<div class="row" style="margin-top: 0; width: 1280px;">

    <!-- Main Panel -->
    <div class="col-xs-9" style="height: 1050px; overflow-x: hidden; overflow-y: scroll;">

        <div style="height: 20px; margin: 15px 0 10px 15px;">

        <span class="joshint"
              style="{% if not edit %}display: none;{% endif %} font-size: 14pt;"
              data-toggle="tooltip"
              title="Dragging bottom right triangle changes the editor's height"
              data-placement="bottom">
        Hint: Dragging changes editor size
        </span>
        </div>

        <!-- Title -->
        <div class="row" style=" ">
            <div class="col-xs-12">

                {% if edit %}

                    <button id="j_button j_action_button"
                            class="btn btn-info btn-xs pull-right edit_section_button"
                            style="font-size: 14pt; width: 125px; margin-top: -31px;"
                            onclick="josCKEdit('title');"
                            data-toggle="tooltip"
                            data-placement="bottom"
                            title="Activates editor"
                    >
                        EDIT TITLE
                    </button>

                    <a id="title_cancel_btn"
                       class="btn btn-danger btn-xs pull-right edit_section_button"
                       style="font-size: 14pt; width: 125px; margin-top: -31px; margin-right: 135px; display: none;"
                       onclick="josCKDestroy('title');"
                       data-toggle="tooltip"
                       data-placement="bottom"
                       title="Warning: discards recent changes!"
                    >
                        DISCARD
                    </a>


                    <!-- This div holds editor. -->
                    <div id="title_editor_container" style=" "></div>

                {% endif %}

                <!-- This div displays contents. -->
                <div id="title_original_content"
                     class="homehead text-center {% if edit %}edit_border{% endif %} edit_border_class">
                    {{ story.title | striptags | safe }}<br>
                </div>
            </div>
        </div>

        <!-- Author -->
        <div class="row text-center" style="margin-top: 25px;">

            <a id="author" class="joslargelinkbutton joscursive" href="{% url "profile" story.author.id %}"
               style="padding: 0;">
            <span style="font-size: 48pt; margin: 0 15px;">
                {{ story.author.JOSProfile.friendly_jos_name }}
            </span>
            </a>

        </div>

        <!-- Discussion -->
        <div class="row">

            <div class="homehead" style="font-size: 28pt; margin-left: 30px; margin-top: 0;">
                Community discussion:
            </div>

            <div class="col-xs-11 col-xs-offset-1" style="margin-top: 0;">

                {% for comment in comments %}

                    <div class="row" style="color: rgb(217,83,79); font-size: 20pt; margin-top: 20px;">
                        <div class="col-xs-3">
                            {{ comment.sent_at | date:"M d" }}; {{ comment.sent_at | time:"f A" }}
                        </div>
                    </div>

                    <div class="row" style="font-size: 20pt; margin-top: 20px;">

                        {% if comment.sender != request.user %}

                            <div class="col-xs-2" style="padding: 0;">
                                {% include "josmembers/user_picture_include.html" with user=comment.sender height=60 %}
                            </div>

                            <div class="col-xs-9"
                                 style="border: 1px solid rgb(65, 45, 120); padding: 15px; min-height: 103px;">
                                "{{ comment.body | striptags | safe }}"
                            </div>

                        {% else %}

                            <div class="col-xs-9"
                                 style="border: 1px solid rgb(65, 45, 120); padding: 15px;  min-height: 103px;">
                                "{{ comment.body | striptags | safe }}"
                            </div>

                            <div class="col-xs-2">
                                {% include "josmembers/user_picture_include.html" with user=comment.sender height=60 %}
                            </div>

                        {% endif %}

                    </div>

                {% endfor %}
            </div>

        </div>

        <div id="discuss" class="row" style="">
            <div class="col-xs-10 col-xs-offset-1" style="margin-top: 50px;">


                <a id="comment_cancel_btn"
                   class="j_button j_discard_button"
                   style="font-size: 16pt; margin-top: -31px; display: none;"
                   onclick="josCKDestroy('comment');"
                   data-toggle="tooltip"
                   data-placement="bottom"
                   title="Warning: discards recent changes!"
                >
                    DISCARD
                </a>

                <a id="comment_edit_btn"
                   class="j_button j_action_button"
                   style="font-size: 16pt; margin: -31px 0 0 30px;"
                   onclick="josCKEdit('comment');"
                   data-toggle="tooltip"
                   data-placement="bottom"
                   title="Activates editor"
                >
                    CLICK TO ADD YOUR THOUGHT BELOW ...
                </a>

                <!-- This div holds editor. -->
                <div id="comment_editor_container" style=" "></div>

            </div>
        </div>
    </div>


    </div>





