{% extends "base.html" %}
{% load i18n mezzanine_tags accounts_tags static %}

{% block meta_title %}Seven Days{% endblock %}
{% block title %}Seven Days{% endblock %}
{% block breadcrumb_menu %}{{ block.super }}
    Seven Days to Better Storytelling
{% endblock %}

{% block all_content %}

{#    <div class="section_title" style="margin-top: 20px;">#}
{#        Congratulations {{ request.user.get_short_name }}#}
{#    </div>#}

<style>

    .day_quote {
        font-family: 'Architects Daughter';
        font-size: 28pt;
        font-weight: bold;
    }

    .section_title {
        font-size: 24pt;
        font-weight: bold;
    }

    /* ferris wheel */

    .icon_contain {
        height: 50px;
        width: 50px;
    {#        outline: 2px solid grey;#} position: absolute;
    }

    .segment_icon {
        background-size: 50px 50px;
        height: 100%;
        width: 100%;
        position: relative;
    }

    .right_arrow {
        position: absolute;
        top: 123px;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 40px 0 40px 60px;
        border-color: transparent transparent transparent rgb(65, 45, 120);
    }

    .arrow_circle {
        position: absolute;
        top: 134px;
        width: 60px;
        height: 60px;
        border-radius: 30px;
        background-color: white;
        border: 3px solid rgb(65, 45, 120);
    }

    .arrow_text {
        position: absolute;
        top: 260px;
        transform: rotate(-65deg);
        font-size: 28pt;
        font-weight: bold;
        background-color: transparent;
    }

    @keyframes cwise {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    @keyframes countwise {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(-360deg);
        }
    }

    /* active_step */

    .active_step {
        border-bottom: 4px solid white;
    }

    @keyframes animateBorder {
        to {
            border-bottom: 5px solid #d9534f;
        }
    }

    .active_step {
        animation: 2s animateBorder infinite;
    }

{#    #wheel, canvas {#}
{#        animation: cwise 60s linear 3;#}
{#    }#}
{##}
{#    .segment_icon {#}
{#        animation: countwise 60s linear 3;#}
{#    }#}



</style>

<div id="seven_day_page" style="position: relative; width: 1280px;">

    <span id="top_instruction" class="josinstructions" style="margin-left: 45px;">XXX</span>:

    <div id="wheel" class="jos_flex_container" style="position: absolute; top: 40px; left: 315px;
         width: 330px; height: 330px;">

        <div class="segments" style="position: absolute; height: 330px; width: 330px;
            background-image: url('/static/img/wheel-small-background.png');
            background-size: 330px 330px;
            z-index: -10;">

            <div id="conflict" class="icon_contain" style="left: 89px; top: 64px;">
                <div class="segment_icon"  style="
                     background-image: url('/static/img/icon-conflict.png');"></div>
            </div>

            <div id="plot" class="icon_contain" style="left: 192px; top: 64px;">
                <div class="segment_icon" style="
                     background-image: url('/static/img/icon-plot.png');"></div>
            </div>

            <div id="theme" class="icon_contain" style="left: 141px; top: 230px;">
                <div class="segment_icon" style="
                     background-image: url('/static/img/icon-theme.png');"></div>
            </div>

            <div id="world" class="icon_contain" style="left: 58px; top: 166px;">
                <div class="segment_icon" style="
                    background-image: url('/static/img/icon-world.png');"></div>
            </div>

            <div id="character" class="icon_contain" style="left: 223px; top: 166px;">
                <div class="segment_icon" style="
                     background-image: url('/static/img/icon-character.png');"></div>
            </div>
        </div>
    </div>

    <div id="canvas" class="jos_flex_container" style="position: absolute; top: 40px; left: 315px;
         width: 100%; height: 330px;">

        <img src="/static/img/icon-pnp-center.png" style="position: absolute;
             top: 135px; left: 135px; height: 60px; width: 60px; z-index: 10;">

        <canvas id="pie_canvas" width="330" height="330">
            Your browser does not support HTML5 Canvas; please call us.
        </canvas>
    </div>

    <div class="jos_flex_container active_step" style="position: absolute; top: 370px; left: 315px;
         width: 330px; height: 20px;">
    </div>

    <div style="position: relative;">

        <div id="start_arrow" class="right_arrow" style="left: 45px;"></div>

        <div id="stripe" style="position: absolute; top: 154px; left: 45px;
             width: 975px; height: 20px; background-color: rgb(65,45,120); z-index: -20;">
        </div>

        <div id="welcome_circle" class="arrow_circle" style="left: 175px;">
            <i class="fa fa-check fa-fw" style="position: relative;
            top: -20px; left: -15px; color: rgb(92,184,92); font-size: 60pt;"></i>
        </div>

        <div id="welcome_text" class="arrow_text active_step" style="left: 60px;">WELCOME</div>

        <div id="draft_circle" class="arrow_circle" style="left: 730px;"></div>

        <div id="draft_text" class="arrow_text text-right active_step" style="left: 610px;">
            1ST DRAFT</div>

        <div id="revision_circle" class="arrow_circle" style="left: 875px;"></div>

        <div id="revision_text" class="arrow_text text-right active_step" style="left: 765px;">&nbspREVISION</div>

        <div id="end_arrow" class="right_arrow" style="left: 1010px;"></div>

        <button class="j_button j_save_button" style="
                position: absolute; top: 84px; left: 1085px;
                font-size: 24pt; font-weight: bold;
                height: 150px; width: 150px; border-radius: 75px;"
            onclick=" ">
            SHARE!
        </button>
    </div>

    <div id='DEBUG' style="margin-top: 400px;">
        DEBUG:<br>
        seven_day_progress: {{ request.user.JOSProfile.seven_day_progress }}<br>
        seven_day_els_complete: {{ request.user.JOSProfile.seven_day_els_complete }}
    </div>
</div>

<script>

    var seven_day_instructions = [
        "Click WELCOME to begin",
        "Click on a storywheel WEDGE to continue",
        "Click DRAFT to continue",
        "Click REVISION to continue",
        "Click SHARE! to publish your story"
    ];


    var C = document.getElementById('pie_canvas');
    var ctx = C.getContext('2d');
    var paths = [];
    var wedges = ['none', 'conflict', 'character', 'theme', 'world', 'plot'];
    var oldWedge = 0, newWedge = 0;

    var url_start = "https://joinourstory.com/joscourses/";
    var url_plot = url_start + "plot_template/" + "{{ wheel.id }}";
    var url_characters = url_start + "characters_template/" + "{{ wheel.id }}/0";
    var url_world = url_start + "world_template/" + "{{ wheel.id }}";
    var url_theme = url_start + "theme_template/" + "{{ wheel.id }}";
    var url_conflict = url_start + "conflict_template/" + "{{ wheel.id }}";

    $(document).ready(function () {
        redraw();
        var seven_day_progress = Number('{{ request.user.JOSProfile.seven_day_progress }}');
        console.log('7d: ' + seven_day_progress + 3);
        $('#top_instruction').text(seven_day_instructions[seven_day_progress]);
    });


    function redraw() {
        console.log('drawing');
        ctx.clearRect(0, 0, C.width, C.height);
        paths = [];
        var path1 = new Path2D(), path2 = new Path2D(), path3 = new Path2D();
        var path4 = new Path2D(), path5 = new Path2D();

        ctx.lineWidth = 2.01; // increase to see canvas

        // pie/conflict
        path1.moveTo(7.3, 114.2);
        path1.bezierCurveTo(31.5, 46.0, 95.0, 2.3, 163.9, 0.3);
        path1.lineTo(163.9, 165.0);
        path1.lineTo(163.8, 165.0);
        path1.lineTo(7.3, 114.1);
        path1.closePath();
        ctx.stroke(path1);
        paths.push(path1);

        // pie/character
        path2.moveTo(322.4, 115.5);
        path2.bezierCurveTo(342.9, 185.0, 317.2, 257.6, 262.7, 299.7);
        path2.lineTo(165.9, 166.5);
        path2.lineTo(165.9, 166.4);
        path2.lineTo(322.5, 115.6);
        path2.closePath();
        ctx.stroke(path2);
        paths.push(path2);

        // pie/theme
        path3.moveTo(262.0, 300.4);
        path3.bezierCurveTo(202.3, 341.3, 125.3, 339.3, 68.4, 300.5);
        path3.lineTo(165.2, 167.2);
        path3.lineTo(165.2, 167.3);
        path3.lineTo(262.0, 300.4);
        path3.closePath();
        ctx.stroke(path3);
        paths.push(path3);

        // pie/world
        path4.moveTo(67.1, 299.8);
        path4.bezierCurveTo(9.8, 255.6, -12.2, 181.8, 7.3, 115.7);
        path4.lineTo(163.9, 166.5);
        path4.lineTo(163.8, 166.6);
        path4.lineTo(67.1, 299.7);
        path4.closePath();
        ctx.stroke(path4);
        paths.push(path4);

        // pie/plot
        path5.moveTo(165.2, 0.7);
        path5.bezierCurveTo(237.6, 2.7, 298.7, 49.5, 321.9, 114.4);
        path5.lineTo(165.3, 165.3);
        path5.lineTo(165.3, 165.2);
        path5.lineTo(165.3, 0.7);
        path5.lineTo(165.2, 0.7);
        path5.closePath();
        ctx.stroke(path5);
        paths.push(path5);
    }

    // Handles hovering
    $(document).mousemove(function (e) {

        var wheel = document.getElementById('wheel_box');
        if ($(wheel).css('display') !== 'none') {

            var mousePos = getMousePos(C, e);

            for (i = 0; i < 5; i++) {
                if (ctx.isPointInPath(paths[i], mousePos.x, mousePos.y)) {
                    newWedge = i + 1;
                    break
                } else {
                    newWedge = 0;
                }
            }

            if (newWedge !== oldWedge) {
                redraw();
                if (newWedge !== 0) {
                    ctx.save();
                    ctx.fillStyle = "white";
                    ctx.globalAlpha = 0.6;
                    ctx.fill(paths[newWedge - 1]);
                    ctx.restore();
                }
                oldWedge = newWedge;
            }
        }
    });

    C.addEventListener('click', function (e) {
        var segment = 0;
        var mousePos = getMousePos(C, e);
        for (i = 0; i < 5; i++) {
            if (ctx.isPointInPath(paths[i], mousePos.x, mousePos.y)) {
                segment = i + 1;
                break
            }
        }

        console.log(wedges[segment] + ' clicked');

        //// add other wedges
        if (wedges[segment] === 'plot') {
            location.href = url_plot;
        } else if (wedges[segment] === 'character') {
            location.href = url_characters;
        } else if (wedges[segment] === 'world') {
            location.href = url_world;
        } else if (wedges[segment] === 'theme') {
            location.href = url_theme;
        } else if (wedges[segment] === 'conflict') {
            location.href = url_conflict;
        } else {
            console.log('click - no wedge found')
        }
    });

    function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
        };
    }

</script>

{% endblock all_content %}

