{% extends "josmessages/mailbase.html" %}
{% load i18n %}
{% load url from future %}


{% block inner_breadcrumb_menu %}
    <span style="font-size: 18pt;">Messaging about:</span> {{ subject }}
{% endblock %}


{% block all_content %}

<div class="row">

<div class="col-xs-10 col-xs-offset-1" style="margin-top: 50px;">

    <span class="josinstructions">Subject:</span>
    <span class="homehead"style="margin-left: 10px;">{{ subject }}</span><br><br>

{% for mess in bodies %}

{% if mess.sender != request.user %}

    <div class="row" style="margin-top: 30px;">

        <div class="row">
            <div class="col-xs-6 col-xs-offset-1">
                <span style="font-size: 20pt; margin-left: -50px;">
                    {{ mess.sent_at | time:"f A" }} - {{ mess.sent_at | date:"D, M d" }}
                </span>
                <a href="{% url "profile" msg.sender.id %}"
                   style="margin-left: 5px; margin-right: 10px;">
                    <span style="font-size: 20pt; margin: 0 0 0 5px;">
                        {{ mess.sender.JOSProfile.jos_name }}
                    </span>
                </a>said:
            </div>
        </div>

        <div class="row"
             style="border-bottom: 1px dashed rgb(65, 45, 120);
                        margin-top: 20px;
                        padding-bottom: 10px;">

            <div class="col-xs-1">

                {% if "noimage" in mess.sender.JOSProfile.profile_image_idstr %}
                    <img class="img-responsive" style="display: inline; height: 60px;" src="/static/img/coming-soon-profile.png">
                {% else %}
                    <img class="img-responsive" style="display: inline; height: 60px;"
                         src="http://res-4.cloudinary.com/desg88u7l/image/upload/{{ mess.sender.JOSProfile.profile_image_idstr }}">
                {% endif %}

            </div>

            <div class="col-xs-10"
                 style="border: 1px solid rgb(65, 45, 120);
                     font-size: 20pt;
                     padding: 15px;">

                "{{ mess.body | striptags | safe }}"

            </div>
        </div>
    </div>

{% else %}

    <div class="row" style="margin-top: 30px;">
        <div class="row">
            <div class="col-xs-6 col-xs-offset-6">
                <span style="font-size: 20pt; margin-left: 7px;">
                    {{ mess.sent_at | time:"f A" }} - {{ mess.sent_at | date:"D, M d" }}
                </span>
                <a href="{% url "profile" msg.sender.id %}"
                   style="margin-left: 5px; margin-right: 10px;">
                        <span style="font-size: 20pt; margin: 0 0 0 5px;">
                            {{ mess.sender.JOSProfile.jos_name }}
                        </span>
                </a>said:
            </div>
        </div>

        <div class="row"
             style="border-bottom: 1px dashed rgb(65, 45, 120);
                 margin-top: 20px; padding-bottom: 10px;">

            <div class="col-xs-10 col-xs-offset-1"
                 style="border: 1px solid rgb(65, 45, 120); font-size: 20pt; padding: 15px;">
                "{{ mess.body | striptags | safe }}"
            </div>

            <div class="col-xs-1">
                {% if "noimage" in mess.sender.JOSProfile.profile_image_idstr.profile_image_idstr %}
                    <img class="img-responsive" style="display: inline; height: 60px;" src="/static/img/coming-soon-profile.png">
                {% else %}
                    <img class="img-responsive" style="display: inline; height: 60px;"
                         src="http://res-4.cloudinary.com/desg88u7l/image/upload/{{ mess.sender.JOSProfile.profile_image_idstr }}">
                {% endif %}
            </div>
        </div>
    </div>

{% endif %}

{% endfor %}

    <div id="reply_thread_form" class="row hidden" style="margin-top: 30px;">

        <form action="" method="post">
            {% csrf_token %}

            <div style="margin-left: 60px;">

                {% for field in form %}
                    {% if field.name == "recipient" %}
                        {{ field.as_hidden }}
                        <input id="id_recipient" type="hidden" value="{{ recipient }}" name="recipient">
                    {% elif field.name == "message_thread_id" %}
                        {{ field.as_hidden }}
                        <input id="id_message_thread_id" type="hidden" value="{{ message_thread_id }}" name="message_thread_id">
                    {% else %}
                        <div class="form-group input_{{ field.id_for_label }}
                                                         {{ field.field.type }}
                                                         {% if field.errors %}
                                                            has-error
                                                         {% endif %}">
                            {# field.name #}
                            {% if field.label %}
                                <label class="control-label"
                                       for="{{ field.auto_id }}">{{ field.label | title }}</label>
                            {% endif %}

                            {{ field }}

                            {% if field.errors %}
                                <p class="help-block">
                                    {% for e in field.errors %}
                                        {% if not forloop.first %} / {% endif %}{{ e }}
                                    {% endfor %}
                                </p>

                            {% elif field.help_text %}
                                <p class="help-block">
                                    {{ field.help_text }}
                                </p>
                            {% endif %}

                        </div>
                    {% endif %}
                {% endfor %}

                <button id="#button_cancel"
                        class="btn btn-warning"
                        style=" "
                        onclick="cancel()">Cancel
                </button>

                <script>function cancel() {
                    $('#button_cancel').addClass('hidden');
                    $('#button_send').addClass('hidden');
                    $('#reply_thread_form').addClass('hidden');
                    $('#button_reply').removeClass('hidden');
                    $('#button_inbox').removeClass('hidden');
                    $('#button_delete').removeClass('hidden');
                }</script>

                <input id="#button_send"
                       class="btn btn-default"
                       style="margin-left: 10px; width: 100px;"
                       type="submit" value="Send">

            </div>

        </form>

    </div>

    <!-- Bottom buttons -->
    <div class="row" style="margin-top: 50px;">

        <div class="col-xs-12">

            <a id="button_inbox"
               class="btn btn-warning"
               style="margin-left: 40px;"
               href="{% url 'josmessages:messages_inbox' %}">
                Back
            </a>

            <a id="button_reply"
               class="btn btn-default"
               style="margin-left: 10px; width: 100px;"
               onclick="activateCKEdit()"
               data-toggle="tooltip"
               title="Activates the word processor to reply"
               data-placement="right">
                {% trans "Reply" %}
            </a>

            <a id="button_delete"
               class="btn btn-danger"
               style="margin-left: 10px;"
               href="{% url 'josmessages:messages_delete' message_thread_id %}">
                Delete
            </a>

        </div>
    </div>
</div>
</div>


<script>

    function activateCKEdit() {
        $('#reply_thread_form').removeClass('hidden');
        $('#button_cancel').removeClass('hidden');
        $('#button_send').removeClass('hidden');
        $('#button_reply').addClass('hidden');
        $('#button_inbox').addClass('hidden');
        $('#button_delete').addClass('hidden');
        CKEDITOR.replace(id_body, {
            toolbar: [
                {'name': 'clipboard', 'items': ['Undo', 'Redo', 'Cut', 'Copy', 'Paste']},
                {'name': 'styles', 'items': ['Font', 'FontSize']},
                {
                    'name': 'basicstyles',
                    'items': ['Bold', 'Italic', 'Underline', 'Strike', '-', 'TextColor', 'BGColor']
                },
                {
                    'name': 'paragraph',
                    'items': ['JustifyLeft', 'JustifyCenter', 'JustifyRight', '-', 'NumberedList', 'BulletedList']
                },
                {'name': 'insert', 'items': ['Image', 'Smiley']},
                {'name': 'editing', 'items': ['SelectAll', 'Find']}
            ],
            contentsCss: '/static/ckeditor/ckeditor/contents.css',
            disableNativeSpellChecker: false,
            width: '95%',
            tabSpaces: 4,
            extraPlugins: 'colorbutton'
        });
    }

</script>

{% endblock all_content %}


